<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        body{
            margin: 0;
            font-family: 'Press Start 2P', cursive;
            background: url('bg1.png') no-repeat center center/cover;
            image-rendering: pixelated;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            position:relative;
            overflow: hidden;
        }
        h2 {
            font-size: 20px;
            margin-bottom: 20px;
            image-rendering: pixelated;
        }
        
        
        /* Dashboard Container */
        .dashboard {
            background: #fff;
            padding: 40px;
            border-radius: 10px;
            border:4px solid black;
            backdrop-filter: blur(10px); 
            text-align: center;
            box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        /* Options Buttons */
        .options button {
            display: block;
            width: 300px;
            margin: 10px auto;
            padding: 12px;
            font-size: 15px;
            border: 2px solid black;
            border-radius: 10px;
            cursor: pointer;
            transition: 0.3s;
            font-family: 'Press Start 2P', cursive;
            text-transform: uppercase;
            box-shadow: 4px 4px 0px black;
            transition: all 0.1s ease-in-out;
            color: white;
        }
        #start_btn{
            background: #057837; 
        }
        #settings_btn{
            background: blue;
            
        }
        #leader_btn{
            background: purple;

        }
        #resume_btn{
            background: #6c1ff1; ;
        }
        .options button:hover {
            
                transform: translate(-3px, -3px);
                box-shadow: 7px 7px 0px black;
            
        }

        #logout_btn {
        background: #d9534f;
        color: white;
        }

        .options button {
        margin-bottom: 15px;
        }
        
    </style>

        <!-- Firebase SDK -->
        <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    
        <script>
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBvKjfxmHlxWoU5WA5t70qUqwBcfPDH_Pg",
            authDomain: "campusquest2025.firebaseapp.com",
            databaseURL: "https://campusquest2025-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "campusquest2025",
            storageBucket: "campusquest2025.firebasestorage.app",
            messagingSenderId: "1050671255008",
            appId: "1:1050671255008:web:bc35a7377d07fe8ba2ef85"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        </script>

</head>
<body>
    <body>
        <div class="dashboard">
            <h2>Welcome!!</h2>
            <div class="options">
                <button onclick="startGame()" id="start_btn">Start</button>
                <button onclick="openSettings()" id="settings_btn">Settings</button>
                <button onclick="viewLeaderboard()" id="leader_btn">Leaderboard</button>
                <button onclick="resumeGame()" id="resume_btn">Resume</button>
            </div>
          
        </div>
    
        <script>
            // Firebase references
            const auth = firebase.auth();
            const database = firebase.database();
            let currentUser = null;
          
            // Check if user is logged in
            function checkLoginStatus() {
              auth.onAuthStateChanged(function(user) {
                if (user) {
                  // User is signed in
                  currentUser = user;
                  loadUserData(user.uid);
                } else {
                  // No user is signed in, redirect to login
                  window.location.href = "index.html";
                }
              });
            }
          
            // Load user data from Firebase
            function loadUserData(userId) {
              database.ref('users/' + userId).once('value')
                .then((snapshot) => {
                  const userData = snapshot.val();
                  if (userData) {
                    document.querySelector('h2').textContent = `Welcome, ${userData.username}!`;
                    
                    // Enable/disable resume button based on game progress
                    const resumeBtn = document.getElementById('resume_btn');
                    if (userData.gameProgress > 0) {
                      resumeBtn.disabled = false;
                    } else {
                      resumeBtn.style.opacity = 0.5;
                      resumeBtn.disabled = true;
                    }
                  }
                });
            }
          
            // Game functions
            function startGame() {
              if (!currentUser) return;
              
              alert("Starting new game...");
              
              // Update game progress in Firebase
              database.ref('users/' + currentUser.uid).update({
                gameProgress: 1,
                lastPlayed: firebase.database.ServerValue.TIMESTAMP
              });
              
              // Future: Redirect to game page
              // window.location.href = "game.html";
            }
          
            function openSettings() {
              alert("Opening settings...");
              // Settings functionality
            }
          
            function viewLeaderboard() {
              alert("Loading leaderboard...");
              
              // Fetch leaderboard data from Firebase
              database.ref('users').orderByChild('gameProgress').limitToLast(10).once('value')
                .then((snapshot) => {
                  const leaderboardData = [];
                  snapshot.forEach((childSnapshot) => {
                    const userData = childSnapshot.val();
                    leaderboardData.push({
                      username: userData.username,
                      score: userData.gameProgress || 0
                    });
                  });
                  
                  // Display leaderboard (in console for now)
                  console.log("Leaderboard:", leaderboardData.reverse());
                  alert("Check console for leaderboard data");
                });
            }
          
            function resumeGame() {
              if (!currentUser) return;
              
              database.ref('users/' + currentUser.uid).once('value')
                .then((snapshot) => {
                  const userData = snapshot.val();
                  if (userData && userData.gameProgress > 0) {
                    alert(`Resuming game at level ${userData.gameProgress}...`);
                    // Load game state
                  } else {
                    alert("No saved game found. Starting new game...");
                    startGame();
                  }
                });
            }
          
            // Logout function
            function logout() {
              auth.signOut().then(() => {
                window.location.href = "index.html";
              });
            }
          
            // Add logout button
            document.addEventListener('DOMContentLoaded', function() {
              checkLoginStatus();
              
              const optionsDiv = document.querySelector('.options');
              const logoutButton = document.createElement('button');
              logoutButton.textContent = "LOGOUT";
              logoutButton.id = "logout_btn";
              logoutButton.style.background = "#d9534f";
              logoutButton.addEventListener('click', logout);
              optionsDiv.appendChild(logoutButton);
            });
          </script>
    
</body>

</html>